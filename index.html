<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPE Relational View: Findings, Conclusions, Recommendations</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* gray-50 */
        }
        .card {
            border-left-width: 4px;
            transition: all 0.2s ease-in-out;
            margin-bottom: 1.5rem; 
        }
        .card:last-child {
            margin-bottom: 0;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .card-rec { border-color: #1d4ed8; background-color: #eff6ff;} /* Blue-700 border, Blue-50 bg */
        .card-con { border-color: #ea580c; background-color: #fff7ed;} /* Orange-600 border, Orange-50 bg */
        .card-fin { border-color: #dc2626; background-color: #fef2f2;} /* Red-600 border, Red-50 bg */

        .connector-path {
            stroke: #9ca3af; /* gray-400 */
            stroke-width: 2;
            fill: none;
        }
        .recommendation-group {
            position: relative;
            padding: 3rem 0;
            border-bottom: 2px dashed #d1d5db; /* gray-300 */
        }
         .recommendation-group:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto px-4 lg:px-8 py-12 max-w-7xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-blue-800">Country Programme Evaluation</h1>
            <p class="text-xl text-gray-600 mt-2">A Relational View of Findings, Conclusions & Recommendations</p>
        </header>

        <div id="content-container" class="relative z-10">
             <!-- Groups will be injected here by script -->
        </div>

        <footer class="text-center mt-16 text-sm text-gray-500">
            <p>This infographic illustrates how multiple findings build into a conclusion, and how conclusions support an overarching recommendation.</p>
        </footer>
    </div>

    <script>
        const data = {
            recommendations: [
                { id: 'rec1', name: "Develop an Integrated Strategic Framework", description: "Create a unified Theory of Change that integrates thematic areas, proactively addresses megatrends, and ensures a consistent systems-based approach across the country programme." },
                { id: 'rec2', name: "Systematize Normative Influence and Financing", description: "Strengthen UNFPA's normative role by linking high-quality data to financing dialogues, accelerating the shift from funding to financing, and ensuring budget traction for key initiatives." },
                { id: 'rec3', name: "Enhance Effectiveness through Equity-Focused Delivery", description: "Improve programme effectiveness by making equity and LNOB visibility a core component of service delivery, scaling up proven models, and ensuring fiscal stability for essential services like GBV support." },
                { id: 'rec4', name: "Streamline Operations and Institutionalize Innovation", description: "Increase efficiency by addressing operational and execution bottlenecks, and create a formal, office-wide pathway for integrating and scaling innovations from pilot to routine practice." },
                { id: 'rec5', name: "Strengthen Humanitarian-Development-Peace Nexus", description: "Bolster the HDP nexus by securing dedicated funding for resilience-building activities and advocating for policy adjustments that allow for more durable, long-term development linkages." }
            ],
            conclusions: [
                { id: 'con1', name: "Conclusion 1", description: "Strategic alignment is strong, but integrated systems change is constrained by the absence of an umbrella ToC and lagging revisions of thematic ToCs." },
                { id: 'con2', name: "Conclusion 2", description: "UNFPA’s normative and neutral convenor roles are central drivers of systems change, yet uptake and budget traction are uneven." },
                { id: 'con3', name: "Conclusion 3", description: "Contributions to effectiveness are substantial but uneven; equity visibility is the Achilles’ heel." },
                { id: 'con4', name: "Conclusion 4", description: "Efficiency-oriented adaptations protected delivery during shocks, but operational frictions slow execution." },
                { id: 'con5', name: "Conclusion 5", description: "Sustainability and the transition from funding to financing are advancing but fragile." },
                { id: 'con6', name: "Conclusion 6", description: "The HDP nexus is operational in Cox’s Bazar, but resilience remains underfunded and policy-constrained." },
                { id: 'con7', name: "Conclusion 7", description: "Innovations are largely project-led and not integrated in the ToCs and DNA." },
                { id: 'con9', name: "Conclusion 9", description: "Megatrends have shifted from context to primary drivers of results." },
                { id: 'con15', name: "Conclusion 15", description: "LNOB implementation is widespread but not systematic; disability visibility must be fixed." },
            ],
            findings: [
                { id: 'fin1', name: "Finding 1", description: "The 10th CP is largely adapted to vulnerable groups, but partners’ capacity to apply LNOB, gender, and disability lenses remains uneven." },
                { id: 'fin2', name: "Finding 2", description: "The 10th CP is aligned with national/global frameworks, and UNFPA leveraged its role to facilitate policy dialogues." },
                { id: 'fin3', name: "Finding 3", description: "Thematic ToCs guided alignment, but the absence of an umbrella ToC limits an integrated systems approach." },
                { id: 'fin4', name: "Finding 4", description: "Coherence is progressing unevenly, with a lack of systematic documentation for cross-thematic milestones." },
                { id: 'fin7', name: "Finding 7", description: "UNFPA's influential role drives an evidence-driven normative agenda, active in key fora and channeling data into policy." },
                { id: 'fin9', name: "Finding 9", description: "Innovations are useful but remain mostly project-led and under-communicated rather than an office-wide function." },
                { id: 'fin10', name: "Finding 10", description: "UNFPA made a substantial—though uneven—contribution to strengthening national and district systems for SRHR, GBV and A&Y." },
                { id: 'fin11', name: "Finding 11", description: "Marginalized groups benefit from interventions, but data cannot yet demonstrate they benefited *most*." },
                { id: 'fin13', name: "Finding 13", description: "Resources were sufficient for priority outputs, but adequacy and timeliness were uneven, creating stop-start delivery." },
                { id: 'fin14', name: "Finding 14", description: "Programme–operations coordination was effective, enabling efficient resource use, though episodic frictions remained." },
                { id: 'fin16', name: "Finding 16", description: "Adaptations to shocks were timely and efficiency-oriented, but residual system frictions caused occasional stop-start delivery." },
                { id: 'fin17', name: "Finding 17", description: "Capacity development has embedded behaviors with potential for continuity and replication." },
                { id: 'fin18', name: "Finding 18", description: "Normative frameworks shaped with UNFPA inputs are enabling sustainability through costed policies and new SOPs." },
                { id: 'fin19', name: "Finding 19", description: "The shift from funding to financing is consolidating sustainability, with institutionalized budgets and diversified models." },
                { id: 'fin20', name: "Finding 20", description: "Humanitarian programming has operationalized the HDP nexus, coupling life-saving services with resilience-building." }
            ],
            connections: [
                { recommendation: 'rec1', conclusions: ['con1', 'con9'], findings: { 'con1': ['fin3', 'fin4'], 'con9': ['fin3'] } },
                { recommendation: 'rec2', conclusions: ['con2', 'con5'], findings: { 'con2': ['fin1', 'fin2', 'fin7'], 'con5': ['fin17', 'fin18', 'fin19'] } },
                { recommendation: 'rec3', conclusions: ['con3', 'con15'], findings: { 'con3': ['fin10', 'fin11'], 'con15': ['fin1', 'fin11'] } },
                { recommendation: 'rec4', conclusions: ['con4', 'con7'], findings: { 'con4': ['fin13', 'fin14', 'fin16'], 'con7': ['fin9'] } },
                { recommendation: 'rec5', conclusions: ['con6'], findings: { 'con6': ['fin20'] } }
            ]
        };

        function createCard(item, type) {
            const card = document.createElement('div');
            card.id = `card-${item.id}`;
            card.className = `card card-${type} rounded-lg shadow-md p-4`;
            card.innerHTML = `
                <h3 class="font-bold text-md">${item.name}</h3>
                <p class="text-sm mt-1 text-gray-700">${item.description}</p>
            `;
            return card;
        }

        function renderContent() {
            const container = document.getElementById('content-container');
            
            data.connections.forEach((group, index) => {
                const groupEl = document.createElement('div');
                groupEl.className = 'recommendation-group';
                groupEl.id = `group-${index}`;

                const svgEl = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svgEl.id = `svg-${index}`;
                svgEl.setAttribute('class', 'absolute top-0 left-0 w-full h-full z-0');
                svgEl.style.pointerEvents = 'none';

                const gridEl = document.createElement('div');
                gridEl.className = 'grid grid-cols-1 md:grid-cols-3 gap-8 items-center';
                
                const findCol = document.createElement('div');
                const conCol = document.createElement('div');
                const recCol = document.createElement('div');
                
                let groupFindings = new Set();
                group.conclusions.forEach(conId => {
                    if(group.findings[conId]) {
                        group.findings[conId].forEach(finId => groupFindings.add(finId));
                    }
                });

                data.findings.filter(f => groupFindings.has(f.id)).forEach(item => findCol.appendChild(createCard(item, 'fin')));
                data.conclusions.filter(c => group.conclusions.includes(c.id)).forEach(item => conCol.appendChild(createCard(item, 'con')));
                data.recommendations.filter(r => r.id === group.recommendation).forEach(item => recCol.appendChild(createCard(item, 'rec')));

                gridEl.appendChild(findCol);
                gridEl.appendChild(conCol);
                gridEl.appendChild(recCol);
                groupEl.appendChild(svgEl);
                groupEl.appendChild(gridEl);
                container.appendChild(groupEl);
            });
        }
        
        function drawAllConnections() {
            data.connections.forEach((group, index) => {
                const svg = document.getElementById(`svg-${index}`);
                const groupEl = document.getElementById(`group-${index}`);
                svg.innerHTML = ''; 

                const groupRect = groupEl.getBoundingClientRect();

                let groupConnections = [];
                group.conclusions.forEach(conId => {
                    groupConnections.push({ from: conId, to: group.recommendation });
                    if(group.findings[conId]) {
                        group.findings[conId].forEach(finId => {
                            groupConnections.push({ from: finId, to: conId });
                        });
                    }
                });
                
                groupConnections.forEach(conn => {
                    const fromEl = document.getElementById(`card-${conn.from}`);
                    const toEl = document.getElementById(`card-${conn.to}`);

                    if (!fromEl || !toEl) return;

                    const fromRect = fromEl.getBoundingClientRect();
                    const toRect = toEl.getBoundingClientRect();

                    const startX = fromRect.right - groupRect.left;
                    const startY = fromRect.top + fromRect.height / 2 - groupRect.top;

                    const endX = toRect.left - groupRect.left;
                    const endY = toRect.top + toRect.height / 2 - groupRect.top;
                    
                    const controlX1 = startX + 80;
                    const controlX2 = endX - 80;

                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.setAttribute('d', `M ${startX} ${startY} C ${controlX1} ${startY}, ${controlX2} ${endY}, ${endX} ${endY}`);
                    path.setAttribute('class', 'connector-path');
                    svg.appendChild(path);
                });
            });
        }

        window.addEventListener('load', () => {
            renderContent();
            setTimeout(drawAllConnections, 150); 
        });

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(drawAllConnections, 150);
        });

    </script>
</body>
</html>

